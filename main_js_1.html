<script>
  let formComponent;
  const SELECT_MANIP = "select_manip";
  const SELECT_USER = "select_user";
  const INPUT_LIST = "input_list";

  const manipSelector = document.getElementById(SELECT_MANIP);
  const userSelector = document.getElementById(SELECT_USER)
  /**
   * @class
   * Form component
   */
  class FormComponent {
    /**
     * @param {object[]} userArray
     * @param {object[]} manipArray
     * @constructor
     */
    constructor(userArray, manipArray) {
      /**
       * @type {object[]}
       * Array of selectable users
       * parameters :
       * @type {string} lastName
       * @type {string} firstName
       * @type {number} number
       */
      this.userArray = userArray.map((user)=>({...user,
        id : user.nickName + "_" +user.number
      }))
      /**
       * @type {object[]}
       * Array of selectable manip
       * parameters :
       * @type {string} date
       * @type {string} name
       */
      this.manipArray = manipArray.map((manip)=>({...manip,hasAnInput : false}));

      /**
       * @type {object[]}
       * Array of manip which got an input
       * parameters :
       *
       */
      this.inputArray = [];
      /**
       * @type {number}
       * Index of the chosen user
       */
      this.chosenUserIndex = this.userArray[0];
      /**
       * @type {boolean}
       * If the form is submited or not
       */
      this.isSubmited = false;
      /**
       * @type {boolean}
       * If the form has been validated by the back-end
       */
      this.isValidated = false;

      // Builds the DOM when the form is displayed
        Promise.all([this.buildManipSelector(),this.buildUserSelector()])
        .then(onSuccess)
        .catch(onError);
    }

    /**
     */
    buildManipSelector() {
      return new Promise((resolve, reject) => {
        try {
          for (let i = 0; i < manipSelector.options.length; i++) {
            manipSelector.options[i] = null;
          }
          let newOpt;
          for (let manip of this.manipArray) {
            if (!manip.hasAnInput) {
              newOpt = document.createElement('option');
              newOpt.value = manip.name;
              newOpt.innerHTML = manip.name;
              manipSelector.appendChild(newOpt);
            }
          }
          resolve();
        } catch (e) {
          reject(JSON.stringify(e));
        }
      });
    }

    /**
     */
    buildUserSelector() {
      return new Promise((resolve, reject) => {
        try {
          let newOpt;
          for (let user of this.userArray) {
            newOpt = document.createElement('option');
            newOpt.value = user.id;
            newOpt.innerHTML = upperFirstLetter(user.firstName) + " " +
              upperFirstLetter(user.lastName);
            userSelector.appendChild(newOpt);
          }
          resolve("user selector building successfull");
        } catch(e){
          reject(console.log(JSON.stringify(e)));
        }
      })
    }
  }


  /**
   * @param {object} err
   */
  const onError = (err) => {
    console.error(JSON.stringify(err))
  }

  /**
   * @param {object} success
   */
  const onSuccess = (success) => {
    console.log("Success : " + JSON.stringify(success))
  }

  /**
   * @param {string} a string
   */
  const upperFirstLetter = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();
</script>
